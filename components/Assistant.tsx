import React, { useState, useEffect } from 'react'
import SpeechRecognition, { useSpeechRecognition } from 'react-speech-recognition'
import { useContext } from "react"
import { State } from "../context/State"
import { useRouter } from 'next/router'

interface Props {
    
}

const Assistant = (props: Props) => {
    const router = useRouter()
    const [redirectUrl, setredirectUrl] = useState("")
    const { handleTranscript, handleUrl }: any = useContext(State)
    const commands = [
        {
            command: ["va sur *", "Aller sur *", "Aller à *", "Ouvrir *", "Accéder à *", "Retourner sur *", "Retourner a *", "Retour à *", "Retourne sur *", "Go sur *"],
            callback: (redirectPage: any) => (
                setredirectUrl(redirectPage),
                handleUrl(redirectPage)
            )
        },
        {
            command: 'stop',
            callback: () => SpeechRecognition.stopListening()
        },
        {
            command: 'annuler',
            callback: () => SpeechRecognition.abortListening()
        },
        {
            command: 'effacer',
            callback: ({ resetTranscript }: any) => resetTranscript()
        }
    ]
    const { transcript } = useSpeechRecognition({commands})

    const pages = ["accueil", "Accueil", "actus", "actu", "projets", "projet"]

    const urls: {[key: string]: string} = {
        accueil: "/",
        Accueil: "/",
        actus: "/actus",
        actu: "/actus",
        projets: "/projets",
        projet: "/projets"
    }

    if(!SpeechRecognition.browserSupportsSpeechRecognition) {
        return null
    }

    if(redirectUrl) {
        if(pages.includes(redirectUrl)) {
            router.push(urls[redirectUrl])
            setredirectUrl("")
        } else {
            router.push("/error")
            setredirectUrl("")
        }
    }

    const handleListening = () => {
        SpeechRecognition.startListening({ continuous: true })
    }


    useEffect(() => {
        handleTranscript(transcript)
        handleUrl(redirectUrl)
    }, [transcript])

    return (
        <>      
            <div className="fixed bottom-0 right-0 p-2 z-999 rounded m-2 btnglass hover:cursor-pointer text-gray-900 hover:text-gray-700">
                <button onClick={handleListening}>
                    <svg id="Calque_1" data-name="Calque 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 355.92 476.46">
                        <path fill="#3c3c3c" d="M196.31,69.27c16.87-7.32,33.46-12.85,51.56-12.41a115.46,115.46,0,0,1,68.58,23.92c2.39,1.81,6,2.06,9,3-.56-5.07,0-10.59-1.94-15.09-2.72-6.43-8.71-11.68-10.6-18.21-3-10.5,4.28-20.66,14.53-22.9,8.21-1.79,21.1,6.06,22.56,15,.87,5.37-.91,11.16-1.39,16.76-.18,2.14-.56,4.41-.05,6.42,5.31,20.79,6.57,41.92,5.82,63.26-.22,6.21,1.09,11.5,5.68,16.75,9.77,11.19,7.3,30-3.24,41.48A155.13,155.13,0,0,0,338.74,211c-17.62,28.82-44.59,40.74-76.56,46.52-14.51,2.63-27.91.55-41.46-2-7.41-1.36-14-6.69-21.19-9.77-18.62-8-27.49-25.52-39.76-39.79-2.85-3.31-7.41-5.1-10.64-8.17-6.89-6.54-7.45-14.41-4.59-23.21,1.28-3.94,1.22-8.38,1.34-12.61.11-3.62-.9-7.33-.5-10.9,1-8.88,3-17.17-1.72-26.3-3.67-7.16,2.39-15.78,13.65-20.07,7.11-2.71,7.77-6.49,8.15-13.07C166,82,169,72.49,170.2,62.83a25.94,25.94,0,0,0-1.78-13.16c-3.59-7.94-2.9-16.43,3.23-24.07,5.37-6.69,11.93-9.55,20.38-6.78,13.13,4.31,18.65,27.44,8.22,36.74C195.76,59.57,194.26,63.11,196.31,69.27ZM297,133.2c-13.5-5.45-26.16-12.62-39.72-15.52-18.39-3.94-37.47-4.68-56.28-6.63-4.91-.51-10.07.36-14.79-.76-11.57-2.76-21.59.8-30.93,6.8-1.75,1.13-2.85,5.64-2,7.71.7,1.76,4.93,3.57,7.05,3.07,19.13-4.52,38.43-4.56,57.58-1.44,16.87,2.76,33.61,6.92,45.58,20.79,11.1,12.87,8.07,27.23-8.15,32.43-10.4,3.34-21.9,3.34-32.94,4.58-21.81,2.45-43.44,3.13-64-6.77-1.24-.6-5,1.14-5.61,2.62-2.31,5.44-.23,10.31,4.83,12.77a64.15,64.15,0,0,0,16.6,5.56c27,4.76,54,3.41,80.91-.46,10.43-1.49,20.57-5.3,30.63-8.69,2-.69,4.6-4.38,4.38-6.41C288.24,166.41,289.64,150.47,297,133.2ZM176.71,98.64c45.15-3.52,86,5.51,121.85,27.6,7.28-4.1,13.88-7.39,20-11.46,2.11-1.4,3.71-4.56,4.22-7.17,1.5-7.71-3.92-11.77-8.84-16.61-14.7-14.48-33.23-20.1-52.62-20.63-16.14-.44-32.37,3.59-48.62,5C196.63,76.82,186.84,86.88,176.71,98.64Zm116.63,95.07c-37.59,17.55-77,23-120.13,18.31,19.67,26.79,45.4,33.7,74.22,33.69,29.33,0,56-6.45,77.11-31.13C308.35,214.15,300.73,204,293.34,193.71Zm46.87.8c-2.2-.22-3.53-.43-4.87-.48-10.42-.42-15.93-7.95-20.24-15.62-5.07-9-5.62-20.42,1.85-27.22,9.23-8.4,4.56-17.43,7.18-26.93-10.77,1.65-17,7-18.43,15.53-2.05,12.22-4.15,24.87-3,37,.85,8.75,5.71,18,11.16,25.2C319.62,209.62,333.44,205.44,340.21,194.51ZM231,141c-2.76-.56-7.35-1.3-11.83-2.46-9.95-2.58-18.49-2.14-24.7,7.92-3.25,5.27-8,9.65-12.34,14.21-2.77,2.93-6,5.46-10.37,9.47,10.8,1.69,19,3.08,27.16,4.14a5.69,5.69,0,0,0,4.18-1.82C212.81,161.67,222.38,150.75,231,141Zm-17.83,33.93a101.25,101.25,0,0,0,41.42-3.18c2.63-.78,5.32-5.59,5.71-8.82,1-8-5.13-15.06-13.38-18-8.47-3-11.87,3.41-16,8.24C225,160.1,219.41,167.25,213.16,174.93ZM321.3,167.3c2,9.89,8,17.39,15.28,17.73,8.52.39,12.64-4.05,13.83-14.66a83.57,83.57,0,0,1,1.9-12.24c1.78-6.65-2.15-10.76-7-12.52-3.45-1.25-9.88-.58-11.94,1.84C328.41,153.25,325.21,160.59,321.3,167.3ZM191.54,132c-11.61,1.5-21.64,2.71-31.64,4.19a6.89,6.89,0,0,0-4,2.69c-8,11.27-1.07,28.55,10.8,30.44C174.61,157.43,182.22,146,191.54,132Zm152.11,3.8c-1.08-22.6-2.14-44.73-3.2-67.1-6.25.34-6.76,4.23-6.53,9.72.51,12,.32,24,.37,36,0,7.47,0,14.94,0,22.69ZM331.89,39.37c-6.46-.43-12.1-.48-12.66,7.4-.44,6.16,5,10.72,13,11.18,6.46.37,10.66-3.07,10.52-9.05C342.59,42.46,338.65,38.2,331.89,39.37Zm-142.42,9.3c5.91.75,8.7-2.43,8.92-8.11.24-6-5.88-11.39-13.1-11.43-5.74,0-9.69,2.83-10.34,8.77C174.19,44.92,179.1,48.46,189.47,48.67Zm-6,11.73c-5.65,4.39-6.72,12.51-3.37,21.23C185.64,77.39,185.64,77.39,183.46,60.4Z" transform="translate(-78.04 -17.77)"/>
                        <path fill="#3c3c3c" d="M235.51,475.69,212.2,494.22l-2.55-1.79,12-23.66L206.46,459c-3.08,18.55-19.08,24.06-31.91,35.26,3.47-17.39,14.48-28.31,24.2-40.05l-11.4-8.63c-6.59,8.7-12.56,18.14-20.1,26.11s-16.82,14.65-22.8,19.74c9.29-16.08,14.84-39,35.33-51.52-3.47-6.79-5.88-12.77-9.35-18.05-9.68-14.73-6-28.86,2.93-41.54s20.08-24.18,30-36.34c6.85-8.36,13.21-17.12,20.07-25.47,10.46-12.75,20.58-25.86,32-37.75,8.94-9.35,21.19-7.92,32.55-5.14,21.49,5.25,39,17.52,52.53,34.54a157.5,157.5,0,0,1,20,33.31c4.81,10.71,2.17,22.3-3.64,32.37a232,232,0,0,1-16,23.43c-13.83,18.38-27.56,36.86-42.1,54.67a109.83,109.83,0,0,1-22,20.42C265.5,482.2,256.85,485.78,235.51,475.69Zm31.11-37.78c-3.63.18-6.75,1.32-8.62.26-7.23-4.1-13.91-9.19-21.17-13.23-1.94-1.08-6.08-.81-7.74.59-11.09,9.3-7.5,31.72,5.84,37.8,4.07,1.86,8.4,3.14,12.47,5,12.36,5.66,21.53,3.35,30.6-7.92-2.29-3.11-4.88-6.05-6.7-9.41a5.57,5.57,0,0,1,.67-5.22c.83-.85,3.52-.44,5.1.16,2,.78,3.65,2.71,5.7,3.39s4.26.34,6.41.45c.28-.67.57-1.33.85-2-6.8-4.56-10.63-10-6.08-19.15l14.19,9.26c4.23-3.27,4.52-5.8-.21-8.91-6-3.93-6.85-9.36-3.24-16.79l15.05,10.71,5.41-7.27c-7.52-4.79-12.4-10.36-8.89-21.57l15,10.25,4.56-5.12c-7.12-5-9.3-10.64-6.32-18.27,13.32,6,15.31,6.6,17.34,5-6.21-4.63-10.44-10-5-19l12.8,9.06c2.1-9.13,5.55-17.13,5.39-25.06-.27-13.56-8.84-24.26-16.22-35-.81-1.17-3.38-1.4-5.18-1.57-11.62-1.05-17.5,6.91-23.75,15.17,6.55,7.53,13.09,14.79,19.26,22.35,1.22,1.5,1,4.19,1.42,6.33-2.25-.13-4.71.26-6.71-.52s-3.44-2.73-5.09-4.2c-5.12-4.56-10.21-9.14-15.1-13.52-5.81,4.56-5.89,8-1.06,12.24a103.48,103.48,0,0,1,12.47,13.56c1.39,1.75,1.38,4.61,2,7-2.51-.36-5.58.06-7.42-1.24-6.28-4.46-12.13-9.52-18.46-14.6l-6.91,7.54c6.35,6,12.39,11.38,18,17.2,1.39,1.43,1.37,4.23,2,6.39-2.31.05-5.14,1-6.81,0-4-2.42-7.48-5.74-11.15-8.72-4.94-4-9.42-5.1-13.3,3.25,5.24,5,11,10.21,16.3,15.9,1.88,2,2.42,5.28,3.57,8-3.18-.44-7,.08-9.44-1.51-6.36-4.15-12.12-9.22-18.13-13.92l-3.09,1.64c.71,2.67.67,6,2.28,7.89,4.45,5.36,9.74,10,14.37,15.25,1.39,1.58,1.7,4.11,2.5,6.21-2.48,0-5.48.89-7.36-.18-6.26-3.56-12-8.12-18.26-11.63-2-1.12-5.15-.18-9.88-.18ZM256.13,329.36c.42-.82.85-1.63,1.28-2.44,11,.1,18.36,9,28.15,13.35l4.64-6.35-19.48-20.48,2-3,24.49,13.05L323,303c-7.45-5.65-14.85,4-22.81-.09l8.52-13-25.53,7.09c3.42-5.62,5.52-9.08,8.18-13.47l-20.68,7,2.49-8.79c-11.35-.6-16.09,7.56-22.07,15.13,2.26,1.09,4.38,1.53,5.56,2.82,1.88,2.06,3.15,4.7,4.68,7.09-2.6.73-5.17,1.89-7.81,2.1-4.38.35-8.81.1-13.22.1a7,7,0,0,0,2,4.24c2.24,2.77,6.7,6.18,6.17,8.29-1.57,6.17-6.93,2.7-10.38,1.66-5.14-1.55-8-.17-9.78,4.79.93.63,2.17,1,2.71,1.9,1.6,2.51,2.93,5.2,4.36,7.81-2.73.49-5.89,2.11-8.11,1.26-7.77-3-9.62,1.91-11.86,7.43A21.35,21.35,0,0,1,219,349.1c1.87,2.3,3.51,4.79,5.24,7.2-3,0-6.55.9-9-.3-7.4-3.56-10,.55-12.34,6.48a21.84,21.84,0,0,1,2.45,2.31c2,2.52,3.88,5.12,5.81,7.68-3.08-.13-6.52.55-9.18-.58-6-2.55-7.87.79-9.8,5.16a10.42,10.42,0,0,1,2.13,1.86c2,3.22,3.85,6.51,5.76,9.77-3.28-.1-6.56-.22-9.84-.28-2,0-4.7-.79-5.94.2-5.5,4.4-6.82,20.38-1.41,28.78l4.47-9.51L191,431.81l2.69,2c2.67-3.27,5.34-6.54,8.29-10.13,0,11.46-1.49,24.56,14.84,28.53-2.9-9.2-4.4-18.14,1.13-26.84,6-9.45,5.2-14-3.33-21.75-1.45-1.31-3.46-2.17-4.53-3.7s-1.33-3.72-2-5.61c2,0,4.38-.61,6,.22,6.4,3.33,12.57,7.12,19.81,11.3,5.15-14.84-12.3-17.25-15.16-29.16,4.08,1,6.93,1.23,9.39,2.35,4.58,2.09,8.79,5,13.45,6.88,2.11.84,4.94-.15,9.73-.45l-20.82-23.28c11.56-1.39,18.23,7.21,27.55,10.63,1.5-1.93,3-3.85,5.22-6.76-6.37-6.05-12.55-11.76-18.48-17.72-1.13-1.12-1.24-3.26-1.82-4.93,1.78-.22,3.93-1.18,5.27-.52,6,3,12.34,5.77,17.51,9.93,5.89,4.73,8,2.43,9.85-2.9Z" transform="translate(-78.04 -17.77)"/>
                        <path fill="#3c3c3c" d="M121.9,282.91c-3.17,4.75-7.42,9.1-9.32,14.32-6.93,18.92-13.13,23-34.54,19.79,3.07-.87,6.11-1.88,9.21-2.6,9.58-2.22,14.84-7.5,15.73-17.94s4.64-20,16.25-23.08c10.89-2.93,18.37,1.15,20.82,12.26,1.73,7.81,1.43,16.06,2.21,24.1.66,6.87,1.15,13.8,2.6,20.51.57,2.66,3.54,4.8,5.42,7.18l2.52-.67c1.69-6.06,3.48-12.1,5.06-18.2,4.39-16.92,11.25-19.18,25.63-9.89,3.95,2.55,10.26,1.44,14.82,1.94-5.61,8.74-10.62,9.89-26.53,4.26-2,7.18-3.61,14.4-5.93,21.39-5.2,15.67-17.5,18.14-29.31,6.67-6.35-6.15-9.22-13-9-21.68A188.88,188.88,0,0,0,126.8,302c-.46-6.09-1.31-12.16-2-18.24Z" transform="translate(-78.04 -17.77)"/>
                        <path fill="#3c3c3c" d="M434,456.28c-5.22.63-10.47,1.91-15.67,1.74-6.66-.22-11.81.85-15.53,7.23-4.25,7.27-11.72,9.89-19.51,8.19-3.5-.76-7.71-4.8-8.92-8.28-2.48-7.16-3.16-15-4.71-23.19-13.45-1.29-16.18,17-29,17.12,4.24-6.59,8.23-12.86,12.28-19.08,5.13-7.88,13.11-11.32,20.77-9,7.21,2.16,11.81,9.18,11.94,18.31,0,2-.28,3.94-.12,5.88.39,4.76,3.4,6.49,6.44,2.91C404.87,442.85,419.21,448.89,434,456.28Z" transform="translate(-78.04 -17.77)"/>
                    </svg>
                    Control Vocal
                </button>
            </div>
        </>
    )
}

export default Assistant